<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MemberDAO">


	<!-- 로그인 확인 -->
	<select id='idCheck' resultType="MemberVO" parameterType="MemberVO">
		select *
   		from pet.members
   		where id = #{id} AND member_status = 'Y'
	</select>
	
	
	<select id='passCheck' resultType="MemberVO" parameterType="MemberVO">
		select id, pass, name
   		from pet.members
   		where id = #{id}
	</select>

	<!-- 아이디 비번 찾기 -->
	<select id='idfind' resultType="MemberVO" parameterType="MemberVO">
		select id
   		from pet.members
   		where email = #{email} AND tel = #{tel} AND name = #{name}
	</select>
	
	<!-- 비밀번호 변경 -->
	<select id='changepass' parameterType="MemberVO">
		UPDATE pet.members
   		SET pass = #{pass}
   		where id = #{id}
	</select>
	
		<select id='passfind' resultType="MemberVO" parameterType="MemberVO">
		select *
   		from pet.members
   		where id = #{id} AND email = #{email} AND tel = #{tel} AND name = #{name}
	</select>
	
	
	<!-- 회원가입 -->
	<insert id="join" parameterType="MemberVO">
        INSERT INTO members (id, pass, name, tel, address, email) VALUES (#{id}, #{pass}, #{name}, #{tel}, #{address}, #{email})
    </insert>
	
	<!-- 아이디 유효성 검사 -->
	<select id="idcheck2" parameterType="String" resultType="Integer"> SELECT COUNT(*) FROM members WHERE id = #{id} </select>
	
	
	<!--  회원정보   -->
	<select id="getMember" resultType="com.javaclass.domain.MemberVO">
	<![CDATA[ SELECT * FROM members WHERE id = #{id} ]]>
	</select>
	
	<!--   수정  -->
<select id="getDiscountRate" resultType="HashMap">
<![CDATA[ SELECT g.discount_rate FROM members m INNER JOIN grades g ON m.grade_name = g.grade_name WHERE m.id=#{id} ]]>
</select>
	
	<!--  정보수정  -->
	<update id="updateMember" parameterType="com.javaclass.domain.MemberVO">
	<![CDATA[ UPDATE members SET pass = #{pass}, tel = #{tel}, email = #{email}, address = #{address} WHERE id = #{id} ]]>
	</update>
	
	
	
	<!-- 회원권한 확인 -->
	<select id="searchMemberLv" parameterType="com.javaclass.domain.MemberVO" resultType="Integer">
	SELECT member_lv FROM members WHERE id = #{id}
	</select>
	
	<update id="updateTOP"> UPDATE members SET total_order_price = total_order_price + #{price} WHERE id=#{id}; </update>
	
</mapper>